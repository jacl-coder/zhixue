# æ™ºå­¦å¥‡å¢ƒåç«¯ç›®å½•ç»“æ„è®¾è®¡

## ğŸ“ ç›®å½•ç»“æ„æ¦‚è§ˆ

```
backend/
â”œâ”€â”€ cmd/                    # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ server/            # HTTPæœåŠ¡å™¨å…¥å£
â”‚   â””â”€â”€ game/              # æ¸¸æˆæœåŠ¡å™¨å…¥å£
â”œâ”€â”€ internal/              # ç§æœ‰åº”ç”¨ç¨‹åºä»£ç 
â”‚   â”œâ”€â”€ api/               # APIå±‚ - HTTPè·¯ç”±å’Œå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ handlers/      # HTTPå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ routes/        # è·¯ç”±å®šä¹‰
â”‚   â”‚   â””â”€â”€ middleware/    # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ service/           # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ user/          # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ question/      # é¢˜åº“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ learning/      # å­¦ä¹ è®°å½•æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ ai/            # AIé›†æˆæœåŠ¡
â”‚   â”‚   â””â”€â”€ game/          # æ¸¸æˆåŒ–æœåŠ¡
â”‚   â”œâ”€â”€ repository/        # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ user/          # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”‚   â”œâ”€â”€ question/      # é¢˜åº“æ•°æ®è®¿é—®
â”‚   â”‚   â””â”€â”€ learning/      # å­¦ä¹ è®°å½•æ•°æ®è®¿é—®
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ config.go      # é…ç½®ç»“æ„
â”‚   â”‚   â”œâ”€â”€ database.go    # æ•°æ®åº“é…ç½®
â”‚   â”‚   â””â”€â”€ redis.go       # Redisé…ç½®
â”‚   â””â”€â”€ game/              # æ¸¸æˆæœåŠ¡å™¨é€»è¾‘
â”‚       â”œâ”€â”€ room/          # æˆ¿é—´ç®¡ç†
â”‚       â”œâ”€â”€ session/       # ä¼šè¯ç®¡ç†
â”‚       â””â”€â”€ events/        # æ¸¸æˆäº‹ä»¶
â”œâ”€â”€ pkg/                   # å¯è¢«å¤–éƒ¨åº”ç”¨ä½¿ç”¨çš„åº“ä»£ç 
â”‚   â”œâ”€â”€ auth/              # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ jwt.go         # JWTå¤„ç†
â”‚   â”‚   â””â”€â”€ bcrypt.go      # å¯†ç åŠ å¯†
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ response.go    # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â”œâ”€â”€ validator.go   # æ•°æ®éªŒè¯
â”‚   â”‚   â””â”€â”€ converter.go   # æ•°æ®è½¬æ¢
â”‚   â””â”€â”€ errors/            # é”™è¯¯å¤„ç†
â”‚       â”œâ”€â”€ codes.go       # é”™è¯¯ç å®šä¹‰
â”‚       â””â”€â”€ handler.go     # é”™è¯¯å¤„ç†å™¨
â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹ (GORM)
â”‚   â”œâ”€â”€ user.go            # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ question.go        # é¢˜ç›®æ¨¡å‹
â”‚   â”œâ”€â”€ learning.go        # å­¦ä¹ è®°å½•æ¨¡å‹
â”‚   â””â”€â”€ game.go            # æ¸¸æˆç›¸å…³æ¨¡å‹
â”œâ”€â”€ middleware/            # å…¨å±€ä¸­é—´ä»¶ (å·²å­˜åœ¨)
â”œâ”€â”€ logger/                # æ—¥å¿—ç³»ç»Ÿ (å·²å­˜åœ¨)
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ app.yaml          # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ database.yaml     # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ redis.yaml        # Redisé…ç½®
â”œâ”€â”€ scripts/               # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ build.sh          # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh         # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ test.sh           # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ docs/                  # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ api.md            # APIæ¥å£æ–‡æ¡£
â”‚   â””â”€â”€ swagger.yaml      # Swaggeræ–‡æ¡£
â”œâ”€â”€ go.mod                # Goæ¨¡å—å®šä¹‰ (å·²å­˜åœ¨)
â””â”€â”€ go.sum                # Goæ¨¡å—æ ¡éªŒ (å·²å­˜åœ¨)
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡åŸåˆ™

### 1. **åˆ†å±‚æ¶æ„** (Layered Architecture)
```
APIå±‚ (Handlers) â†’ æœåŠ¡å±‚ (Services) â†’ ä»“åº“å±‚ (Repository) â†’ æ•°æ®å±‚ (Models)
```

### 2. **ä¾èµ–æ³¨å…¥** (Dependency Injection)
- ä½¿ç”¨æ¥å£å®šä¹‰ä¾èµ–å…³ç³»
- ä¾¿äºå•å…ƒæµ‹è¯•å’Œæ¨¡å—æ›¿æ¢

### 3. **å…³æ³¨ç‚¹åˆ†ç¦»** (Separation of Concerns)
- æ¯ä¸ªåŒ…æœ‰æ˜ç¡®çš„èŒè´£
- ä¸šåŠ¡é€»è¾‘ä¸æ•°æ®è®¿é—®åˆ†ç¦»

### 4. **å¯æµ‹è¯•æ€§** (Testability)
- æ¯å±‚éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶
- æ¨¡æ‹Ÿæ¥å£ä¾¿äºå•å…ƒæµ‹è¯•

## ğŸ“¦ ç›®å½•è¯¦ç»†è¯´æ˜

### `/cmd` - åº”ç”¨ç¨‹åºå…¥å£
**ç”¨é€”**: åŒ…å«åº”ç”¨ç¨‹åºçš„ä¸»è¦å…¥å£ç‚¹
- `cmd/server/` - HTTP APIæœåŠ¡å™¨
- `cmd/game/` - Nanoæ¸¸æˆæœåŠ¡å™¨
- æ¯ä¸ªå…¥å£éƒ½æœ‰è‡ªå·±çš„mainå‡½æ•°

### `/internal` - ç§æœ‰ä»£ç 
**ç”¨é€”**: åªèƒ½è¢«å½“å‰åº”ç”¨å¯¼å…¥çš„ç§æœ‰ä»£ç 

#### `/internal/api` - APIå±‚
- **handlers/**: HTTPè¯·æ±‚å¤„ç†å™¨ï¼Œå¤„ç†è·¯ç”±é€»è¾‘
- **routes/**: è·¯ç”±å®šä¹‰å’Œåˆ†ç»„
- **middleware/**: APIå±‚é¢çš„ä¸­é—´ä»¶

#### `/internal/service` - ä¸šåŠ¡é€»è¾‘å±‚
- **user/**: ç”¨æˆ·ç›¸å…³ä¸šåŠ¡é€»è¾‘
- **question/**: é¢˜åº“ç®¡ç†ä¸šåŠ¡é€»è¾‘  
- **learning/**: å­¦ä¹ è®°å½•å’Œåˆ†æä¸šåŠ¡é€»è¾‘
- **ai/**: AIæœåŠ¡é›†æˆä¸šåŠ¡é€»è¾‘
- **game/**: æ¸¸æˆåŒ–åŠŸèƒ½ä¸šåŠ¡é€»è¾‘

#### `/internal/repository` - æ•°æ®è®¿é—®å±‚
- å®ç°æ•°æ®æŒä¹…åŒ–æ¥å£
- å°è£…æ•°æ®åº“æ“ä½œ
- å¯ä»¥æœ‰å¤šç§å®ç° (PostgreSQL, Redis, æ–‡ä»¶ç­‰)

### `/pkg` - å…¬å…±åº“ä»£ç 
**ç”¨é€”**: å¯ä»¥è¢«å¤–éƒ¨åº”ç”¨ä½¿ç”¨çš„åº“ä»£ç 

#### `/pkg/auth` - è®¤è¯æˆæƒ
- JWT tokenç”Ÿæˆå’ŒéªŒè¯
- å¯†ç åŠ å¯†å’ŒéªŒè¯
- æƒé™æ£€æŸ¥

#### `/pkg/utils` - å·¥å…·å‡½æ•°
- ç»Ÿä¸€çš„å“åº”æ ¼å¼
- æ•°æ®éªŒè¯å™¨
- ç±»å‹è½¬æ¢å™¨

### `/models` - æ•°æ®æ¨¡å‹
**ç”¨é€”**: GORMæ•°æ®æ¨¡å‹å®šä¹‰
- å¯¹åº”æ•°æ®åº“è¡¨ç»“æ„
- åŒ…å«æ•°æ®éªŒè¯æ ‡ç­¾
- å®šä¹‰è¡¨å…³è”å…³ç³»

### `/configs` - é…ç½®æ–‡ä»¶
**ç”¨é€”**: åº”ç”¨ç¨‹åºé…ç½®
- ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶
- æ•°æ®åº“è¿æ¥é…ç½®
- ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®

## ğŸ”„ æ•°æ®æµç¤ºä¾‹

### ç”¨æˆ·æ³¨å†Œæµç¨‹
```
1. HTTPè¯·æ±‚ â†’ /internal/api/handlers/user.go
2. æ•°æ®éªŒè¯ â†’ /pkg/utils/validator.go
3. ä¸šåŠ¡é€»è¾‘ â†’ /internal/service/user/user.go
4. å¯†ç åŠ å¯† â†’ /pkg/auth/bcrypt.go
5. æ•°æ®æŒä¹…åŒ– â†’ /internal/repository/user/user.go
6. æ•°æ®åº“æ“ä½œ â†’ /models/user.go
7. å“åº”æ ¼å¼åŒ– â†’ /pkg/utils/response.go
```

### AIéš¾åº¦è°ƒèŠ‚æµç¨‹
```
1. ç­”é¢˜è®°å½• â†’ /internal/api/handlers/learning.go
2. å­¦ä¹ åˆ†æ â†’ /internal/service/learning/analysis.go
3. AIæœåŠ¡è°ƒç”¨ â†’ /internal/service/ai/difficulty.go
4. éš¾åº¦æ›´æ–° â†’ /internal/repository/user/profile.go
5. æ—¥å¿—è®°å½• â†’ /logger/logger.go
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
```
internal/service/user/user_test.go
internal/repository/user/user_test.go
pkg/auth/jwt_test.go
pkg/utils/validator_test.go
```

### é›†æˆæµ‹è¯•
```
tests/integration/
â”œâ”€â”€ api_test.go
â”œâ”€â”€ database_test.go
â””â”€â”€ redis_test.go
```

## ğŸš€ å¼€å‘æµç¨‹

### 1. **æ¨¡å‹å®šä¹‰** (models/)
- æ ¹æ®æ•°æ®åº“è®¾è®¡åˆ›å»ºGORMæ¨¡å‹
- å®šä¹‰æ•°æ®éªŒè¯è§„åˆ™

### 2. **ä»“åº“å±‚** (internal/repository/)
- å®ç°æ•°æ®è®¿é—®æ¥å£
- å°è£…CRUDæ“ä½œ

### 3. **æœåŠ¡å±‚** (internal/service/)
- å®ç°ä¸šåŠ¡é€»è¾‘
- è°ƒç”¨ä»“åº“å±‚å’Œå¤–éƒ¨æœåŠ¡

### 4. **APIå±‚** (internal/api/)
- å®ç°HTTPå¤„ç†å™¨
- å®šä¹‰è·¯ç”±å’Œä¸­é—´ä»¶

### 5. **æµ‹è¯•éªŒè¯**
- å•å…ƒæµ‹è¯•å„å±‚é€»è¾‘
- é›†æˆæµ‹è¯•å®Œæ•´æµç¨‹

## ğŸ¯ ä¼˜åŠ¿ç‰¹ç‚¹

### 1. **å¯ç»´æŠ¤æ€§**
- æ¸…æ™°çš„ç›®å½•ç»“æ„
- æ˜ç¡®çš„èŒè´£åˆ†å·¥
- æ˜“äºç†è§£å’Œä¿®æ”¹

### 2. **å¯æ‰©å±•æ€§**
- æ¨¡å—åŒ–è®¾è®¡
- ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
- æ”¯æŒå¾®æœåŠ¡æ‹†åˆ†

### 3. **å¯æµ‹è¯•æ€§**
- åˆ†å±‚è®¾è®¡ä¾¿äºæµ‹è¯•
- æ¥å£æŠ½è±¡æ”¯æŒMock
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡é«˜

### 4. **å›¢é˜Ÿåä½œ**
- æ ‡å‡†åŒ–çš„ç›®å½•ç»“æ„
- æ¸…æ™°çš„ä»£ç ç»„ç»‡
- ä¾¿äºä»£ç å®¡æŸ¥

è¿™ä¸ªç›®å½•ç»“æ„éµå¾ªGoç¤¾åŒºæœ€ä½³å®è·µï¼Œé€‚åˆ"æ™ºå­¦å¥‡å¢ƒ"è¿™æ ·çš„ä¸­å¤§å‹é¡¹ç›®ï¼ ğŸš€
